{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组中的部分方法\r\n\r\nlet oldArrayProto = Array.prototype; //获取数组的原型\r\n\r\nexport let newArrayProto = Object.create(oldArrayProto);\r\n\r\nlet methods = [\"push\", \"pop\", \"shift\", \"unshift\", \"reverse\", \"sort\", \"splice\"];\r\n\r\nmethods.forEach((method) => {\r\n  newArrayProto[method] = function (...args) {\r\n    // 这里重写了数组的方法\r\n    const result = oldArrayProto[method].call(this, ...args); // 内部调用原来的方法，函数的劫持，切片编程\r\n\r\n    // 我们需要对新增的数据再次进行劫持\r\n    let inserted;\r\n    let ob = this.__ob__;\r\n    switch (method) {\r\n      case \"push\":\r\n      case \"unshift\":\r\n        inserted = args;\r\n        break;\r\n      case \"splice\":\r\n        inserted = args.slice(2);\r\n      default:\r\n        break;\r\n    }\r\n\r\n    if (inserted) {  \r\n      // 新增的内容\r\n      // 对新增的内容再次进行观测\r\n      ob.observeArray(inserted);\r\n    }\r\n\r\n    return result;\r\n  };\r\n});\r\n","import { newArrayProto } from \"./array\";\r\nclass Observer{\r\n    constructor(data){\r\n        //  object.defineProperty只能劫持已经存在的属性 (vue里面会为此单独写一些api $set $delete)\r\n        Object.defineProperty(data,'__ob__',{    // 将__ob__变成不可枚举 （循环时无法获取到）\r\n            value:this,\r\n            enumerable:false\r\n        })\r\n        // data.__ob__ = this; // 给数据加一个标识，如果数据上有__ob__则说明这个属性被观测过了\r\n        if(Array.isArray(data)){\r\n            // 重写数组中的方法  7个变异方法\r\n            data.__proto__ = newArrayProto // 需要保留数组原有的特性，比能切可以重写部分方法\r\n            this.observeArray(data) // 如果数组中放的是对象 可以监控到对象的变化\r\n        }else{\r\n            this.walk(data)\r\n        }\r\n    }\r\n\r\n    walk(data){ // 循环对象对属性依次劫持\r\n        // 重新定义 属性 \r\n        Object.keys(data).forEach(key=>defineReactive(data,key,data[key]))\r\n    }\r\n    observeArray(data){\r\n        data.forEach(item=>observe(item))\r\n    }\r\n}\r\n\r\nexport function defineReactive(target,key,value){ // 闭包 属性劫持\r\n    observe(value)   //对所有的对象都继续进行属性劫持\r\n    Object.defineProperty(target,key,{\r\n        get(){ // 取值执行get\r\n            return value\r\n        },  \r\n        set(newVal){ // 修改执行set\r\n            if(newVal === value) return\r\n            value = newVal\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe(data){\r\n\r\n    // 对这个对象进行劫持\r\n    if(typeof data !=='object' || data == null){\r\n        return \r\n    }\r\n    if(data.__ob__ instanceof Observer){ // 说明这个对象被代理过了\r\n        return data.__ob__\r\n    }\r\n    // 如果一个对象被劫持，那就不需要再劫持了，要判断一个对象是否被劫持过，可以添加一个实例，用实例来判断是否被劫持过\r\n    return new Observer(data)\r\n}","import { observe } from \"./observe/index\";\r\nfunction initState(vm){\r\n    const opts = vm.$options;\r\n    if(opts.data){\r\n        initData(vm)\r\n    }\r\n}\r\n\r\nfunction proxy(vm,target,key){\r\n    Object.defineProperty(vm,key,{\r\n        get(){\r\n            return vm[target][key]\r\n        },\r\n        set(newVal){\r\n            vm[target][key] = newVal\r\n        }\r\n    })\r\n} \r\n\r\nfunction initData(vm){\r\n    let data = vm.$options.data; // 可能是函数可能是对象\r\n    data = typeof data === 'function' ? data.call(vm) : data\r\n    vm._data = data\r\n    //  对数据进行劫持 vue2 里采用了 defineProperty\r\n    observe(data)\r\n\r\n    // 将vm._data 用vm来代理就可以了\r\n    for(let key in data){\r\n        proxy(vm,'_data',key)\r\n    }\r\n}\r\n\r\nexport default initState","import initState from \"./state\";\r\nexport function initMixin(Vue){\r\n    Vue.prototype._init = function (options){\r\n        // vue  vm.$options 获取用户的配置\r\n        const vm = this;  //保留this\r\n        vm.$options = options //将选项挂载在vue实例上的$options\r\n\r\n        // 初始化状态\r\n        initState(vm)\r\n\r\n    }\r\n}\r\n","import { initMixin } from \"./init\"\r\n\r\nfunction Vue(options){ // options 用户的选项 \r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue "],"names":[],"mappings":"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"}